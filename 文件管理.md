# 一、文件管理

操作系统中得文件系统 **专门负责管理外存储器上得信息** ，用户可以使用“按名”高效、快速和方便地存储信息。

## 1.1 基本概念

### 1.1.1 文件

文件(File)是具有符号名的、在逻辑上具有完整意义的一组相关信息集合。；例如，源程序、目标程序、编译程序、待加工数据、各类文当等都可以各自组成一个文件。

信息项时构成文件内容的基本单位，可以是一个字符，也可以是一个记录(可以等长，也可以不等长)。文件 **包括文件体(真实内容)和文件说明(操作系统管理文件使用的信息，包括文件名、文件内部标识、文件的类型、文件存储地址、文件的长度、访问权限、建立时间、访问时间等)** 。

文件时一种抽象机制，隐藏了硬件和实现细节，提供了将信息保存在磁盘上并进行读取的手段，使用户不必了解信息存储的方法、位置以及存储设备的实际操作方式。操作系统通过文件名对文件进行控制和管理。不同的操作系统文件的命名规范有所不同，文件名的格式和长度不同。

### 1.1.2 文件系统

文件系统时操作系统中实现文件统一管理的一组软件和相关数据的集合，专门负责管理和存取文件信息的软件机构。功能包括如下几个

1. 按名存取，用户可以**按名存取**，而不是**按地址存取**
2. 统一的用户接口，在不同设备上提供相同的接口，方便用户操作和编程
3. 并发访问和控制，多道系统中支持对文件的并发访问和控制
4. 安全性控制，在多用户系统中的不同用户对同一文件可有不同的访问权限
5. 优化性能，采用相关技术提高系统对文件的存储效率、检索和读写性能
6. 差错恢复，能够验证文件的正确性，并具有一定的差错恢复能力

### 1.1.3 文件分类

文件按照性质和用途、保存期限、保护方式等通常有如下分类
1. 按文件性质和用途分为**系统文件、库文件、用户文件**
2. 按信息保存期限可将文件分为**临时文件、档案文件、永久文件**
3. 按文件的保护方式分为**只读文件、读写文件、可执行文件、不保护文件**
4. UNIX系统将文件分为**普通文件、目录文件、设备文件**

文件分类的目的是对不同文件进行管理，提高系统效率以及用户界面友好性。还可以根据文件的存取方法和物理结构不同进行分类。

## 1.2 文件的结构和组织

文件的结构是指 **文件的组织形式** 。文件的 **逻辑结构** 是指用户只需要知道文件的文件名，不用知道这些文件存放在什么地方，就可以存取文件中的信息。文件的 **物理结构** 是指文件在文件存储器上的存放方式。

### 1.2.1 文件的逻辑结构

文件的逻辑结构可分为两大类：**记录式文件和流式文件**

1. **有结构的记录式文件**

    所有的记录通常都是描述一个实体集，有着相同或不同数目的数据项。记录长度可分**定长记录和不定长记录**两类
    * 定长记录。文件中所有记录的长度相同。所有记录中的各个数据项都处在记录中相同的位置，具有相同的顺序以及相同的长度，**文件的长度用记录数目表示**

    * 变长记录。文件中各个记录的长度不相同。一个记录中所包含的数据项数目可能不同，数据项本的长度不定。

2. **无结构的流式文件**

    文件体为字节流，不划分记录。通常采用顺序访问方式，并且每次读写访问可以指定任意的数据长度，以字节为单位。访问方式是**利用读写指针指出下一个要访问的字符**。在UNIX系统中所有文件都被看作流式文件，即使是有结构的文件也被视为流式文件，系统不对文件进行格式处理。

### 1.2.2 文件的物理结构

文件的物理结构是指文件的内部组织形式，即 **文件在物理存储设备上的存放方法。** 由于文件的物理结构决定了文件在存储设备上的存放位置，所以**文件的逻辑块号到物理块号的转换也是由文件的物理块号决定的。**常见的文件物理结构如下

1. **连续结构**，也称为顺序结构，将逻辑上连续的文件信息依次连续存放在连续编号的物理块上。
    * 只要知道文件的起始物理块号和文件长度，可以方便地进行文件存取
    * 对文件中地记录进行批量取出时，效率最高；对于删除或增加，效率较低。

2. **链接结构**，也称串结构，将逻辑上连续的文件信息存放在不连续地物理块上，每个物理块设置一个指向下一个物理块地指针。

3. **索引结构**，将逻辑上连续信文件息存放在不联系地物理块中，系统为每个文件建立一张索引表。索引表记录了文件信息所在地逻辑块号对应地物理块号，并将索引表地起始地址放在与文件的对应文件目录项中。

4. **多个物理块的索引表**，索引表是在文件创建时由系统自动创建，并与文件一起存放在同一文件卷上。索引表一般占用一个或几个物理块(一般采用链接文件或多重索引方式组织)
    
在UNIX文件系统中采用**三级索引结构**，文件系统中i-node是基本的构件，表示文件系统树形结构的特点。有**直接寻址、一级间接寻址、二级间接寻址、三级间接寻址**四种寻址方式

## 1.3 文件目录

系统为每个文件设置用于描述和控制文件的数据结构，至少包含文件名和存放文件的物理地址，这个数据结构称为文件控制块(FCB), 文件控制块(FCB)的有序集合称为文件目录。**文件目录是由文件控制块组成**，专门用于文件检索。FCB称为文件的说明或文件目录项。

### 1.3.1 文件控制块

文件控制块包含以下三类信息

1. **基本信息类**。如文件名、文件的物理地址、文件长度和文件块数等

2. **存取控制信息类**。文件的存取权限，如读、写、执行权限等

3. **使用信息类**。如文件建立日期、最后一次修改日期、最后一次访问日期、当前使用的信息、打开文件的进程数，在文件上的等待队列等

文件控制块的信息因操作系统不同而不同，UNIX系统中，FCB的各项信息为文件类型和存取权限、链接数、文件主、组名、文件长度、最后一次修改日期、文件名。

文件目录由文件控制块组成，专门用于文件的检索。文件目录可以存放在文件存储器固定位置，也可以以文件的形式存放在磁盘上，称为目录文件。

### 1.3.2 目录结构

文件目录结构的组织方式直接影响文件的存取速度，关系到文件共享性和安全性。常见的目录结构由如下3种

1. **一级目录结构**。目录组织是一个线性结构，整个系统只需要建立一张目录表，系统为每个文件分配一个目录项(文件控制块)。实现简单，查找速度慢，不允许重名和比便于文件共享

2. **二级目录结构**。由主文件目录(MFD)和用户文件目录(UFD)组成。在主文件目录中，每个用户文件目录都占一个目录项(文件控制块)，其目录项中包含用户名和指向该用户目录文件的指针。 **用户目录由用户所有文件的目录项组成。**
    * 提高了检索目录的速率
    * 较好地解决了重名问题
    * 有效地将多个用户隔开
    * 用户之间文件共享不便，多个用户合作完成一个大任务时，用户需要相互访问用户文件，隔离带来了此问题。

3. **多级目录结构**。像一颗倒置地有根树，从树根向下，每一个结点是一个目录，叶节点是文件。
    
    采用此目录结构地系统，用户访问文件必须指出文件所在地路径名(从根目录开始到该文件地通路上所有各级目录名拼接起来地到。各目录名之间，目录名与文件名之间需要用分隔符号隔开。Windows分隔符为“\”, UNIX分隔符为“/”)

## 1.4 存取方法、存取控制


