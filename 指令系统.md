# 一、指令系统
**CPU能够完成的操作是由其执行的指令决定** ，这些指令称为机器指令。CPU能执行的指令集合称为CPU的指令系统。指令系统的好坏、功能的强弱影响到计算机效率， **指令系统是计算机硬件与软件的接口**。

## 1.1 指令格式
指令是指挥计算机完成各种操作的基本命令，一般由 **操作码(OP)和地址码(Addr)** 两个部分组成，格式如下
![](https://images.gitee.com/uploads/images/2021/0111/165748_568dcc34_7841459.png "屏幕截图.png")
* 操作码：说明指令功能机操作性质(二进制编码表示)
    * 该字段越长，能够表示的指令越多
* 地址码: 指令操作的对象，操作数与操作数及运算结果的地址

**根据地址码的数量进行分类** 
1. 三地址指令格式

    ![](https://images.gitee.com/uploads/images/2021/0111/170335_1a3dd856_7841459.png "屏幕截图.png")
    * $OP$： 操作码；$A_1, A_2, A_3$分别是源操作数1、源操作数2和目的操作数的地址
    * 实现的操作是$(A_1) OP (A_2) \rightarrow (A_3)$

2. 二地址指令格式

    ![](https://images.gitee.com/uploads/images/2021/0111/170805_cff22e2c_7841459.png "屏幕截图.png")

    * 实现操作$(A_1) OP (A_2) \rightarrow (A_1)$

3. 一地址指令格式

    ![](https://images.gitee.com/uploads/images/2021/0111/170909_34748ec6_7841459.png "屏幕截图.png")
    * 实现操作
        * 针对一个数，$OP (A) \rightarrow (A)$
        * 针对两个数，$(AC) OP (A) \rightarrow (AC)$, $AC$为累加器中的数据

4. 零地址指令格式

    ![](https://images.gitee.com/uploads/images/2021/0111/171231_0ed3565b_7841459.png "屏幕截图.png")
    
    * 无操作数的控制操作，例如；空操作指令NOP，停机指令HLT等
    * 隐含操作数，指令中不体现

## 1.2 寻址方式

寻址方式是如何对指令中的地址字段进行解释，以获得操作数的方法或获得程序转移地址的方法。操作数的位置可能在 **指令、寄存器、存储器或I/O端口**中。常用寻址方式 **立即寻址、直接寻址、寄存器寻址、寄存器间接寻址**

* 立即寻址： **指令包含操作数** ；形成指令时，操作数跟在操作码后面，取出指令即可的到操作数。例如；8086指令系统中，指令`ADD AX, 3048H`是将AX寄存器中内容与3048H相加。 3048H就是操作数，采用立即寻址取得该操作数

* 直接寻址： **操作数存放在内存单元中** ；指令中给出操作数所在的内存地址。例如：8086指令系统，指令`ADD AX, [2000H]`是将AX寄存器中的内容和数据段中偏移地址为2000H的存储单元中的内容相加，结果存入AX寄存器。存储单元2000H中的内容是操作数

* 寄存器寻址:  **操作数存放在寄存器中**，指令中给出存放操作数的寄存器。

* 寄存器间接寻址：操作数存放在内存单元中，操作数所在的存储单元的地址在某个寄存器中。例如，指令`ADD AX, [BX]就是将`BX`寄存器中存放的操作数所在的内存地址对应的操作数取出啦，与`AX`寄存器中的数相加存放到AX中。

* 间接寻址：操作数存放在内存单元中。指令中给出了操作数的地址，取出操作数需要连词访问内存

* 基址寻址：操作数存放在内存单元中。指令中操作数地址码给出基址寄存器和一个偏移量。操作数所在的地址为$基址+偏移量$；例如，指令`MOV AX, [BX+100H]`

* 变址寻址：操作数存放在内存单元中。操作数的有效地址是$变址寄存器的内容+偏移量$例如, 指令`ADD AX, [DI+100H]`其中第二个操作数采用变址寻址方式，DI是编址寄存器

## 1.3 指令种类

不同的CPU所设计的指令系统各不相同，但是基本上所有的指令系统都包含下列几种类型的指令

1. 数据传送类指令：将数据从一个地方传送待另一个对方，包括如下指令
    * 数据传送指令：一般是两个操作数地址。源操作数地址和目的操作数地址，传送方式包括
        1. 将立即数传送到寄存器
        2. 将立即数传送到存储单元
        3. 将一个寄存器的内容传送到另一个寄存器
        4. 将寄存器的内容传送到存储单元
        5. 将数据从一个存储单元传送到另一个存储单元
        6. 将数据由存储单元传送到寄存器。
    * 数据交换指令
        1. 寄存器与寄存器之间数据交换
        2. 存储单元与寄存器之间的数据交换
        3. 存储单元与存储单元之间的数据交换
    * 堆栈操作指令。保存压入堆栈指令和弹出堆栈指令

2. 输入输出(I/O)类指令：实现主机与外设间的信息传送，包括数据的输入/输出、主机向外设发出控制命令及输入外设的状态

3. 算术运算类指令：支持CPU完成加、减、乘、除等算术运算。主要包括**加法、减法、乘法、除法、求补、加1、减1和比较**等指令

4. 逻辑运算指令：支持CPU完成逻辑运算。包括**逻辑与、逻辑或、逻辑非、异或、取反**等指令

5. 移位操作指令：移位根据移动方向分为 **左移位和右移位**，左移位指各位顺序向左移动一位。右移位指各位顺序向右移动一位。移位指令分为**算术移位、逻辑移位和循环移位**
    * 算术移位：对带符号操作数进行移位。执行过程如下图
        ![](https://images.gitee.com/uploads/images/2021/0112/134729_01fc5104_7841459.png "屏幕截图.png")
        * 左移时，从最低为依次向最高位移动，低位补 0， 最高位移入 "进位" C中
        * 右移时，从最高位向最低位依序移动，最低为移入"进位" C中，最高位(符号位)保存不变。
    
    * 逻辑移位。对无符号数进行移位。执行过程如下图

        ![](https://images.gitee.com/uploads/images/2021/0112/142314_f9bc6313_7841459.png "屏幕截图.png")
        * 左移: 与算术左移相同，低位依次向高位移动，低位补 0。
        * 右移：高位向低位移动，高位补 0。
    
    * 循环移位。分为两种；一是不带进位的循环移位，二是带进位的循环移位。
        
        * 不带进位的循环移位
            ![](https://images.gitee.com/uploads/images/2021/0112/150925_ca104fac_7841459.png "屏幕截图.png")
            * 左移: 最高位移入进位标志位，并且将最高位移入最低为
            * 右移: 最低为移入进位标志位，并且将最低位移入最高位
        
        * 带进位的循环移位，将进位标志位C包含在内进行移位
            ![](https://images.gitee.com/uploads/images/2021/0112/151223_02df2f77_7841459.png "屏幕截图.png")
           
6. 程序控制类指令：用于改变指令执行的顺序和控制流的方向，包括以下几种
    * 跳转指令：  **分为无条件跳转和条件跳转指令** 

    * 子程序调用和返回指令： **控制流从一个程序段转到另一个程序段，子程序结束后，必须返回调用它的程序段** 。
        * 子程序: 独立、多次重复使用的功能。
    
    * 陷阱指令： **一种意外事件引起的中断** 。该指令时隐藏的，不提供各用户使用；由CPU自动执行。也有提供用户使用的陷阱指令，使用户用它进行系统调用，利用操作系统完成相关功能

7. 串操作类指令：现代计算机经常处理大量的字符串信息。一般都会设置字符串操作指令。包括**串传送指令、串比较指令、串搜索指令、串替换指令、串转换指令、串抽取指令**

8. 处理机控制指令： **用于对CPU实施控制** 。例如，PSW中标志实现置位或清零、停机指令、开中断指令、关中断指令、空操作指令

9. 数据转换类指令：例如， **将十进制转为二进制、二进制转为十进制、定点数转为浮点数、浮点数转为定点数等** 。